üìô NORMA ‚Äî SEGURAN√áA
________________________________________
0. OBJETIVO E ESCOPO
0.1 Objetivo
1.	Estabelecer regras obrigat√≥rias de seguran√ßa para:
1.1. prote√ß√£o de dados pessoais e sens√≠veis
1.2. isolamento entre usu√°rios (multi-tenancy)
1.3. preven√ß√£o de acessos indevidos
1.4. mitiga√ß√£o de riscos OWASP relevantes
1.5. auditabilidade e rastreabilidade
0.2 Escopo
2.	Esta norma regula:
2.1. autentica√ß√£o e autoriza√ß√£o
2.2. multi-tenancy e isolamento de dados
2.3. acesso a banco de dados (RLS)
2.4. gest√£o de segredos e vari√°veis de ambiente
2.5. logging, auditoria e rastreabilidade
2.6. prote√ß√£o contra ataques comuns (OWASP)
2.7. regras de deploy e opera√ß√£o segura
0.3 Fora de escopo
3.	Qualidade/engenharia (Norma 0.2) e arquitetura (Norma 0.1).
________________________________________
1. PRINC√çPIOS DE SEGURAN√áA (INEGOCI√ÅVEIS)
1.1 Seguran√ßa por padr√£o (Secure by Default)
4.	Toda funcionalidade nasce restritiva e s√≥ √© liberada explicitamente.
5.	Aus√™ncia de regra expl√≠cita implica nega√ß√£o de acesso.
1.2 Menor privil√©gio
6.	Usu√°rios, servi√ßos e processos recebem apenas o acesso m√≠nimo necess√°rio.
7.	Eleva√ß√£o de privil√©gio exige regra expl√≠cita e audit√°vel.
1.3 Defesa em profundidade
8.	Nenhuma camada confia cegamente na outra:
8.1. UI valida UX
8.2. Application valida autoriza√ß√£o
8.3. DB valida isolamento (RLS)
1.4 Zero Trust interno
9.	Nenhuma requisi√ß√£o √© considerada confi√°vel apenas por estar ‚Äúdentro do sistema‚Äù.
________________________________________
2. AUTENTICA√á√ÉO (AuthN)
2.1 Fonte de verdade
10.	Autentica√ß√£o √© centralizada no provedor oficial do projeto.
11.	Nenhum m√≥dulo implementa autentica√ß√£o pr√≥pria paralela.
2.2 Identidade
12.	Todo usu√°rio autenticado possui:
12.1. user_id √∫nico e imut√°vel
12.2. identidade validada por token assinado
2.3 Tokens
13.	Tokens devem:
13.1. ter expira√ß√£o
13.2. ser verificados em toda requisi√ß√£o protegida
13.3. nunca ser logados integralmente
________________________________________
3. AUTORIZA√á√ÉO (AuthZ)
3.1 Regra geral
14.	Autoriza√ß√£o n√£o √© responsabilidade da UI.
15.	Toda a√ß√£o sens√≠vel √© validada no backend.
3.2 Modelo base
16.	O modelo m√≠nimo de autoriza√ß√£o √©:
16.1. usu√°rio s√≥ acessa dados com seu user_id
16.2. aus√™ncia de permiss√£o ‚Üí acesso negado
3.3 Pap√©is (se existirem)
17.	Se pap√©is (roles) forem introduzidos:
17.1. devem ser expl√≠citos
17.2. avaliados no backend
17.3. audit√°veis
________________________________________
4. MULTI-TENANCY (REGRA ABSOLUTA)
4.1 Isolamento por usu√°rio
18.	O KAIROS √© multi-tenant por usu√°rio.
19.	Todo dado persistido deve conter:
19.1. user_id obrigat√≥rio
4.2 Proibi√ß√£o
20.	√â proibido:
20.1. tabelas compartilhadas sem user_id
20.2. confiar apenas em filtro no frontend
20.3. queries sem escopo expl√≠cito de usu√°rio
________________________________________
5. ROW LEVEL SECURITY (RLS) ‚Äî INEGOCI√ÅVEL
5.1 Obrigatoriedade
21.	Toda tabela com dados de usu√°rio DEVE ter RLS habilitado.
22.	Sem RLS ‚Üí merge bloqueado.
5.2 Pol√≠tica m√≠nima obrigat√≥ria
23.	Pol√≠tica padr√£o:
23.1. user_id = auth.uid() para SELECT/INSERT/UPDATE/DELETE
5.3 Proibi√ß√£o
24.	√â proibido:
24.1. desabilitar RLS em produ√ß√£o
24.2. usar service role key no frontend
24.3. contornar RLS por conveni√™ncia
________________________________________
6. ACESSO AO BANCO DE DADOS
6.1 Camada permitida
25.	Acesso ao banco s√≥ pode ocorrer em:
25.1. infra/ das features
25.2. src/core (infra transversal)
6.2 Valida√ß√£o adicional
26.	Mesmo com RLS:
26.1. o backend deve validar coer√™ncia de acesso
26.2. nunca confiar apenas no cliente
________________________________________
7. DADOS PESSOAIS E SENS√çVEIS
7.1 Princ√≠pio da minimiza√ß√£o
27.	Coletar apenas dados estritamente necess√°rios.
28.	Dados n√£o utilizados devem ser removidos.
7.2 Classifica√ß√£o
29.	Dados sens√≠veis incluem, mas n√£o se limitam a:
29.1. telefone
29.2. endere√ßo
29.3. informa√ß√µes de pagamento
29.4. tokens de autentica√ß√£o
7.3 Tratamento
30.	Dados sens√≠veis:
30.1. nunca devem ser logados
30.2. devem ser protegidos por pol√≠ticas de acesso
30.3. quando poss√≠vel, devem ser criptografados em repouso
________________________________________
8. SEGREDOS E VARI√ÅVEIS DE AMBIENTE
8.1 Regras absolutas
31.	Segredos:
31.1. NUNCA podem ser commitados
31.2. NUNCA podem aparecer em logs
31.3. NUNCA podem ser expostos ao cliente
8.2 Uso correto
32.	Vari√°veis sens√≠veis devem:
32.1. existir apenas no ambiente seguro
32.2. ser acessadas apenas no backend
32.3. ter escopo m√≠nimo necess√°rio
________________________________________
9. LOGGING, AUDITORIA E RASTREABILIDADE
9.1 Logging seguro
33.	Logs devem:
33.1. registrar eventos relevantes
33.2. omitir dados sens√≠veis
33.3. permitir correla√ß√£o de eventos
9.2 Auditoria
34.	Eventos audit√°veis incluem:
34.1. login/logout
34.2. falhas de autoriza√ß√£o
34.3. opera√ß√µes cr√≠ticas (ex.: conclus√£o de dia, gera√ß√£o de plano)
________________________________________
10. OWASP TOP 10 ‚Äî APLICA√á√ÉO PR√ÅTICA
10.1 Riscos priorit√°rios mitigados
35.	O sistema deve mitigar, no m√≠nimo:
35.1. Broken Access Control
35.2. Authentication Failures
35.3. Injection
35.4. Security Misconfiguration
35.5. Sensitive Data Exposure
10.2 Regras pr√°ticas
36.	Nunca confiar em input do cliente.
37.	Sempre validar no backend.
38.	Sempre usar prepared statements / SDKs seguros.
39.	Headers de seguran√ßa devem ser habilitados quando aplic√°vel.
________________________________________
11. DEPLOY E OPERA√á√ÉO SEGURA
11.1 Ambientes
40.	Ambientes devem ser separados:
40.1. development
40.2. staging (se houver)
40.3. production
11.2 Produ√ß√£o
41.	Em produ√ß√£o:
41.1. debug desabilitado
41.2. logs restritos
41.3. chaves de produ√ß√£o isoladas
________________________________________
12. PROIBI√á√ïES ABSOLUTAS (SEGURAN√áA)
42.	√â proibido:
42.1. desabilitar RLS
42.2. usar service role no frontend
42.3. expor segredos
42.4. acessar dados sem escopo de user_id
42.5. ‚Äúburlar‚Äù seguran√ßa por conveni√™ncia
________________________________________
13. CHECKLIST DE SEGURAN√áA (MERGE / DEPLOY)
43.	Antes de merge/deploy:
43.1. RLS habilitado em todas as tabelas de usu√°rio?
43.2. Queries escopadas por user_id?
43.3. Nenhum segredo exposto?
43.4. Logs sem dados sens√≠veis?
43.5. Auth/AuthZ validados no backend?
________________________________________
14. GOVERNAN√áA E EXCE√á√ïES
44.	Exce√ß√µes:
44.1. s√£o rar√≠ssimas
44.2. exigem justificativa t√©cnica formal
44.3. exigem aprova√ß√£o do Chat de Governan√ßa
44.4. exigem plano de mitiga√ß√£o e revis√£o
________________________________________
15. STATUS NORMATIVO
45.	Esta norma √© obrigat√≥ria e priorit√°ria.
46.	Viola√ß√£o implica bloqueio de merge e/ou deploy.
